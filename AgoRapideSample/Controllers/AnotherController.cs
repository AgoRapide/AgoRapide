using System;
using System.Collections.Generic;
using System.Linq;
using System.Net;
using System.Net.Http;
using System.Web.Http;
using AgoRapide;
using AgoRapide.Core;
using AgoRapide.Database;
using AgoRapide.API;

namespace AgoRapideSample {
    /// <summary>
    /// This file exists for the sole purpose of showing that you (of course) may have multiple Controllers in your project.
    /// 
    /// Note how each controller should be added as a parameter in the call to 
    /// <see cref="APIMethod.CreateSemiAutogeneratedMethods"/> in <see cref="WebApiConfig.Register"/>
    /// </summary>
    public class AnotherController : BaseController {

        /// <summary>
        /// NOTICE TO DEVELOPER: Do not change any functionality here as method is used in the AgoRapide documentation 
        /// NOTICE TO DEVELOPER: (including demonstration of exception handling mechanism, like overflow for instance)
        /// </summary>
        /// <param name="SomeNumber"></param>
        /// <returns></returns>
        [HttpGet]
        [Method(
            Description = "Doubles the number given (every time)",
            S1 = "DemoDoubler", S2 = P.SomeNumber)]
        public object DemoDoubler(string SomeNumber) {
            try {
                if (!TryGetRequest(SomeNumber, out var request, out var errorResponse)) return errorResponse;
                var answer = checked(request.Parameters.PV<long>(P.SomeNumber.CP()) * 2);
                return request.GetOKResponseAsText(answer.ToString(), "Your number doubled is: " + answer);
            } catch (Exception ex) {
                return HandleExceptionAndGenerateResponse(ex);
            } finally {
                DBDispose();
            }
        }

        [HttpGet]
        [Method(
            Environment = AgoRapide.Environment.Development, // This method will not show up on your Production-server.
            Description = "Triples the number given (every time)",
            S1 = "DemoTripler", S2 = P.SomeNumber)]
        public object DemoTripler(string SomeNumber) {
            try {
                if (!TryGetRequest(SomeNumber, out var request, out var errorResponse)) return errorResponse;
                var answer = request.Parameters.PV<long>(P.SomeNumber.CP()) * 3;
                return request.GetOKResponseAsText(answer.ToString(), "Your number tripled is: " + answer);
            } catch (Exception ex) {
                return HandleExceptionAndGenerateResponse(ex);
            } finally {
                DBDispose();
            }
        }

    }
}